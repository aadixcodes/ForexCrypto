generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  password        String
  name            String
  phone           String         @unique
  aadharNo        String         @unique
  pan             String         @unique
  gender          String
  dob             DateTime
  nomineeName     String
  nomineeRelation String
  bankName        String
  accountNumber   String         @unique
  accountHolder   String
  ifscCode        String
  address         String
  isVerified      Boolean        @default(false)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  orders          OrderHistory[]
  transactions    Transaction[]
}

model Transaction {
  id                String            @id @default(uuid())
  userId            String
  type              TransactionType
  transactionId     String            @unique
  razorpayPaymentId String?           @unique
  razorpaySignature String?
  status            TransactionStatus
  amount            Float
  currency          String            @default("INR")
  description       String?
  metadata          Json?
  failureReason     String?
  timestamp         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  paymentMethod     PaymentMethod?
  user              User              @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([timestamp])
}

model OrderHistory {
  id          String   @id @default(uuid())
  userId      String
  tradeDate   DateTime
  tradeAmount Float
  quantity    Int
  buyPrice    Float
  sellPrice   Float
  profitLoss  Float
  user        User     @relation(fields: [userId], references: [id])
}

enum TransactionType {
  WITHDRAW
  DEPOSIT
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentMethod {
  CARD
  UPI
  NETBANKING
  WALLET
}
